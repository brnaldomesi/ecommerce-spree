namespace :ioffer do
  task :import_top_items => :environment do
    item_ids = [615318698, 624510317, 624806679, 625093985, 630278303, 630336179, 633490957, 636135029, 639011619, 639824068, 640089095, 640354316, 640367677, 640519592, 640715781, 640718944, 640815938, 640845816, 641105974, 641175549, 641321500, 641535086, 641582725, 641765783, 641767258, 641937122, 642074509, 642539770, 642557784, 642655911, 642694035, 642705986, 642828962, 642839635, 642915739, 642997711, 643102931, 643315921, 643532788, 643542427, 643685793, 643689864, 643878162, 644110431, 644159218, 644212704, 644480196, 644562663, 644588766, 645702870, 645740034, 646111785, 646164351, 646486064, 647260420, 647287981, 647328229, 647647342, 649024369, 649460291, 649639339, 649649705, 649760937, 650458693, 650985241, 651933640, 651938074, 651960070, 652163590, 652284196, 652856470, 653135812, 653287870, 653515021, 653777236, 654082750, 654150955, 654153484, 654298768, 655217785, 655297768, 655679359, 655858672, 656955463, 656955883, 657118360, 657275683, 657395932, 657484663, 657510655, 657556993, 657662449, 658063504, 658605154, 658655152, 658660471, 658775983, 658780741, 658781356, 658832617, 658885777, 658916494, 658963072, 659006278, 659058715, 659186848, 659320138, 659482540, 660416812, 660554413, 660941410, 661002100, 661002952, 661150159, 661334482, 662198677, 662534011, 663408097, 663456439, 663701572, 663724846, 665101456, 665131420, 665177578, 665184079, 665434375, 665522461, 665560672, 665563678, 665572528, 665662858, 665739979, 665758777, 665841841, 666578626, 667261492, 667283572, 767662864, 767832115, 767833414, 767946661, 767989756, 769014211, 769072333, 769229071, 769281832, 769285189, 770177926, 770648467, 770657818, 770889388, 770910439, 770985178, 771681208, 771907282, 772185910, 772209121, 772755628, 773061736, 773277859, 773410111, 773899270, 774576382, 776076832, 776361265, 776950705, 777067078, 777074284, 777149446, 778055806, 778244263, 778271518, 778273021, 778298773, 778390564, 778396606, 778414876, 778420168, 778439356, 778442695, 778899562, 779003251, 779170393, 779555941, 780089596, 780527965, 780530113, 780560209, 780616138, 781018657, 781500538, 781776196, 782418772, 782433187, 782450197, 782480944, 782834503, 783046879, 783464020, 784004845, 784023838, 784054414, 784055530, 784084768, 784374388, 784807993, 784854424, 784874170, 784975060, 785052055, 785313823, 785740369, 785752873, 786297274, 786346420, 786445609, 786752815, 786854038, 787237579, 787772458, 788871883, 789699550, 789853891, 790603942, 790857052, 791249605, 791688961, 791866543, 792085357, 792166078, 792191602, 792413119, 792446563, 792656695, 794625292, 795476024, 795478097, 797813045, 798007640, 798017123, 798627227, 798819485, 799893254, 800163782, 800171189, 800180198, 800266205, 801052871, 801055133, 606655428, 615698520, 616641056, 616658732, 617176884, 617387942, 620438721, 621945387, 623433189, 623491215, 623962915, 624119959, 624145239, 624350283, 624524613, 625277351, 627601317, 629425749, 629648453, 629692467, 629696251, 629740929, 629952831, 630049129, 630234943, 630896587, 631633499, 633434375, 633692015, 633756137, 633862988, 634077676, 634938000, 635112448, 635595341, 635601213, 636366149, 636537720, 637661358, 637776202, 637812607, 637813102, 637817397, 637839376, 638063619, 638216827, 638309785, 638962702, 639478138, 639500527, 639551036, 639677725, 639825784, 639859698, 640042860, 640107886, 640154300, 640254047, 640279429, 640354152, 640462603, 640739930, 640767858, 640906316, 641227618, 641254295, 641264637, 641419229, 641448461, 641470216, 641473612, 641488310, 641492128, 641493460, 641495118, 641552192, 641619615, 641620667, 641642426, 641663374, 641688039, 641801848, 641895841, 641916028, 642026221, 642174464, 642206429, 642258525, 642325635, 642381077, 642407294, 642418842, 642473988, 642475314, 642536532, 642587216, 642613232, 642652275, 642662329, 642667201, 642761333, 642828790, 642844965, 642844978, 642852166, 642876547, 642892861, 642894250, 643009712, 643156291, 643157761, 643365397, 643380702, 643406248, 643408698, 643436392, 643440508, 643451764, 643464810, 643494005, 643499855, 643516990, 643517172, 643517784, 643536166, 643572432, 643595886, 643597165, 643607499, 643615091, 643689539, 643715223, 643814390, 643821307, 643832461, 643833476, 643840939, 643841657, 643856515, 643876984, 643881512, 643892692, 643893561, 643935167, 643971517, 643991228, 644023112, 644522805, 644527395, 644578053, 644614890, 644655795, 644656392, 645014604, 645053598, 645127929, 645134706, 645168978, 645377571, 645553716, 645858978, 645859605, 645860292, 645899331, 646126491, 646129815, 646218861, 646225047, 646225281, 646328900, 646336181, 646348345, 646348375, 646349293, 646349601, 646349649, 646353241, 646356663, 646378539, 646419771, 646445387, 646561259, 646561347, 646592637, 646724523, 646811843, 646811975, 646928756, 646928798, 647111899, 647259760, 647341144, 647488786, 647616760, 647693896, 647695183, 647718985, 647755546, 647769469, 647797635, 647967957, 647982726, 647983356, 647984463, 647984637, 647998038, 647998353, 648657374, 648662477, 648695396, 648767459, 648767804, 648768722, 648769667, 648770864, 648798497, 649109161, 649143753, 649147218, 649167480, 649193438, 649193474, 649194158, 649214963, 649216517, 649216766, 649220315, 649234853, 649257632, 649275953, 649290715, 649333069, 649459161, 649480875, 649483585, 649543121, 649557861, 649594133, 649617438, 649667519, 649841737, 650067444, 650068982, 650070719, 650127889, 650261026, 650322733, 650365219, 650373826, 650514151, 650552767, 650735314, 650762176, 650778940, 650791483, 650793724, 650862495, 650862575, 650894593, 650895021, 650912889, 651017475, 651073597, 651134941, 651178495, 651231169, 651690869, 651710735, 651892001, 651909837, 651997363, 652013200, 652162636, 652444807, 652581508, 652653721, 652763470, 652763536, 652781635, 652818325, 652822576, 652869451, 652878268, 652903906, 652994098, 653000014, 653288707, 653383771, 653559463, 653601676, 653603497, 653702071, 654242533, 654267676, 654281740, 654298447, 654346039, 654458893, 654476413, 654847522, 654893854, 655060969, 655070083, 655188898, 655642540, 655876018, 656011915, 656013304, 656182195, 656245066, 656281438, 656362558, 656536297, 656598853, 656712859, 656887177, 657235195, 657287290, 657294823, 657385822, 657562693, 657562924, 657564898, 657565126, 657565543, 657713500, 657814438, 657867172, 657868225, 657869986, 657878110, 657889720, 657894679, 657923029, 658136113, 658707145, 658707289, 658707457, 658707469, 658886716, 658914925, 658915639, 659000347, 659097556, 659175391, 659223175, 659223271, 659543704, 659547136, 659788171, 660128497, 660128539, 660378964, 660534616, 660566866, 661179403, 661485661, 661836061, 661901662, 662269966, 663021709, 663023455, 663025354, 663453964, 663528298, 663756499, 663825301, 663827962, 663849847, 664029538, 664100119, 664262119, 664384288, 664903807, 664995142, 665047171, 665054005, 665062483, 665063806, 665097766, 665097940, 665210947, 665410324, 666074167, 666443416, 666604711, 667067536, 667099111, 667173214, 768459004, 768914959, 768916300, 768917587, 768999772, 769713406, 770418814, 770548408, 770549911, 770550421, 770794195, 771376840, 771769621, 771772153, 771776059, 772505812, 772743274, 773472580, 773721796, 774649981, 774905575, 775123852, 776734219, 777015910, 777016453, 777142807, 777283555, 779795587, 779843515, 780668956, 781044927, 783560431, 783955222, 783982258, 784275598, 785368201, 785755030, 788261338, 789212230, 790616941, 791368501, 792017866, 792019012, 792581701, 792820381, 792824500, 794042722, 794321371, 794329717, 794645743, 798140225, 799711418]

    ioffer_site = Retail::Site.where(name:'ioffer').first
    found_page_count = 0
    found_page_statuses = {}
    found_product_count = 0
    newly_created_count = 0
    item_ids.each_with_index do |ioffer_item_id, index|
      puts "#{index} .. " if index % 100 == 1
      begin
        # url = "/i/#{ioffer_item_id}"
        page = ::Scraper::Page.where(retail_site_id: ioffer_site.id).where("url_path LIKE '/i/%#{ioffer_item_id}'").first

        if page
          found_page_count += 1
          status_count = found_page_statuses[page.file_status] || 0
          status_count += 1

          found_page_statuses[page.file_status] = status_count

          product = page.try(:retail_product)
          if product
            found_product_count += 1
            ::Spree::Product.transaction do
              spree_product = product.spree_products.first
              unless spree_product
                newly_created_count += 1
                spree_product ||= create_as_spree_product
              end
            end
          end
        end
      rescue Exception => product_e
        puts "** Error in creating #{ioffer_item_id}: #{product_e}"
      end
    end
    puts "\n==================================="
    puts "Out of #{item_ids.size}, found #{found_page_count} pages, #{found_product_count} products, #{newly_created_count} new"
    puts "  page statuses: #{found_page_statuses}"

  end

end